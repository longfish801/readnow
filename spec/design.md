# 設計書

## フォルダ構成

* amaisbn/ ISBN取得ツールファルダ
* draft/ 原稿フォルダ
	- master.tpac マスタファイル
	- reviews{yyyy}.txt 感想ファイル
* docs/ 公開フォルダ
	- json/ 公開原稿フォルダ
		- master.json 公開マスタファイル
		- reviews{yyyy}.json 公開感想ファイル
* rough/ 下書きフォルダ
	- {yyyymmdd}.txt 感想履歴ファイル
	- latest.tpac 追加感想ファイル
* spec/ 仕様書フォルダ
* src/ ソースコードフォルダ
	- main/ Groovyソースコードフォルダ
	- test/ テストコードフォルダ
	- yakumo/ Yakumoフォルダ
* webpack/ サイト表示スクリプト生成ツールフォルダ

## 機能一覧

* 追加感想ファイル生成機能
	- 感想履歴ファイルを追加感想ファイルに変換します。
* ISBN取得機能
	- 追加感想ファイルにISBNを追記します。
* 追加感想ファイル反映機能
	- 追加感想ファイルを原稿に反映します。
* 公開原稿生成機能
	- 原稿を公開原稿に変換します。
* サイト表示機能
	- 感想をサイトに表示します。

## 画面一覧

以下をすべての画面にて表示します。

* サイトタイトル
* メニュー

各画面の表示内容は以下のとおりです。

* メニュー
	- 刊行年目次画面へのリンク
	- 著者目次画面へのリンク
	- タグ目次画面へのリンク
		- タグ目次画面のH1見出し（カテゴリ）へのリンク一覧
* トップ画面
	- H1：読了なう
	- 過去10年以内からランダムに感想を5件表示
* 案内画面
	- H1：ご案内
	- H2：このサイトについて
	- H2：注意
* 感想表示画面
	- H1：（表示対象の感想のタイトル）
* 刊行年目次画面
	- H1：刊行年一覧
	- 刊行年別一覧画面へのリンク一覧
* 刊行年別一覧画面
	- H1：（表示対象の刊行年）
	- 目次（ページ内リンク）
	- H2：（表示対象の刊行年月）
	- H3：（表示対象の感想のタイトル）
* 著者目次画面
	- H1：著者一覧
	- 目次（ページ内リンク）
	- H2：（著者名の頭文字）
	- 著者別一覧画面へのリンク一覧
* 著者別一覧画面
	- H1：（表示対象の著者名）
	- 目次（ページ内リンク）
	- H2：（表示対象の感想のタイトル）
* タグ目次画面
	- H1：タグ一覧
	- 目次（ページ内リンク）
	- H2：（カテゴリ名）
	- タグ別一覧画面へのリンク一覧
* タグ別一覧画面
	- H1：（表示対象のタグ名）
	- 目次（ページ内リンク）
	- H2：（表示対象の感想のタイトル）

## URL一覧

* /
    - ご案内
* /reviews/:reviewID
    - 感想表示画面
* /pubdates
    - 刊行年目次
* /pubdates/:yyyy
    - 刊行年別一覧
* /authors
    - 著者目次
* /authors/:authorID
    - 著者別一覧
* /tags
    - タグ目次
* /tags/:tagID
    - タグ別一覧

## ファイル設計

### 追加感想ファイル

　以下の宣言並びにハンドルを記述します。

* reviews宣言
	- ハンドル名：刊行年
		- 必須
		- "yyyy"形式
* reviewハンドル
	- reviews宣言の子
	- ハンドル名：略称
		- 必須
		- “★”＋著者名（複数ある場合は半角アンダーバーで連結）＋'|'＋タイトル
		- サイトでは見出しに使用します
		- 先頭の“★”は公開感想から追加分を確認するための目印です
		- タイトルに副題（全角スペース区切り以降）は含めません  
		  半角スペースは半角アンダーバー(_)に置換します

　reviewハンドルには以下のキーを指定します。

* titleキー
	- タイトル
	- 必須
	- サブタイトルは全角スペースで区切ります
* authorsキー
	- 著者
		- 正確には作品の制作に携わったものたちの代表を指します
		- たとえば編者をここに記述することもあります
	- 必須、複数指定可
	- 補足情報は"［編］"のように全角角括弧で囲みます
* creatorsキー
	- その他の作り手（訳者、編者など）
	- 省略可、複数指定可
	- 補足情報は"［編］"のように全角角括弧で囲みます
* publisherキー
	- 版元
	- 必須
* pubdateキー
	- 刊行年月
	- 必須
	- "yyyy年m月"形式
* keywordキー
	- 以下の検索キーワードとして利用します
		- AmazonからISBNを参照
		- 書影をクリックしたときのGoogle検索キーワード
	- 必須
* isbnキー
	- ISBN-13
	- 必須
* bodyキー
	- 本文
	- 必須

### 感想ファイル

　以下の宣言並びにハンドルを記述します。

* reviews宣言
	- ハンドル名：刊行年
		- 必須
		- "yyyy"形式
* pubdate
	- reviews宣言の子
	- ハンドル名：刊行年月
		- 必須
		- "yyyy年m月"形式
* reviewハンドル
	- pubdateハンドルの子
	- ハンドル名：タイトル
		- 必須
		- 追加感想ファイルの値を使用します

　reviewハンドルには以下のキーを指定します。
　追加感想ファイルから転記するキーは説明を省略しています。

* titleキー
* authorsキー
* creatorsキー
* publisherキー
* pubdateキー
* keywordキー
* isbnキー
* tagsキー
	- タグ名＋半角スペース( )＋タグ値
		- タグ値は省略できる
		  省略時はタグ名のみ記述
	- 省略可、複数指定可
* bodyキー
* noteキー
	- 付記
	- 省略可
* secretキー
	- ネタバレ
	- 省略可

### マスタファイル

　以下の宣言、ハンドル、キーを記述します。

* master宣言
* pubyearsハンドル
	- テキスト：刊行年のリスト
		- 必須
		- "yyyy"形式
* authorsハンドル
	* authorハンドル
		- ハンドル名：著者名
			- 必須
			- 感想データのauthorsだけでなく creatorsも含みます。
		* hiraNameキー
			- 著者名のひらがな読み
			- 必須
* tagsハンドル
	* tagハンドル
		- ハンドル名：タグ名
			- 必須
* categoriesハンドル
	* categoryハンドル
		- ハンドル名：カテゴリ名
			- 必須
		- テキスト：タグのリスト

### 公開感想ファイル

　全体がひとつのマップです。

- キーは idキー（後述）の値、
  値は以下のキーを持つマップです。
	- idキー
		- 刊行年月(yyyymm)＋半角数字２桁の通番
	- titleキー
		- HTML化します
	- abbreキー
		- 略称
		- 半角パイプ(|)を " / "に、半角アンダーバー(_)を半角スペースに置換した上でHTML化します
	- authorsキー
		- 値は以下のキーがあるマップのリストです
			- idキー
				- 著者ID
			- formatキー
				- 著者名を"%s"に置き換えた文字列です
				- 補足情報がないときはキー自体がありません
	- creatorsキー
		- 値は以下のキーがあるマップのリストです
			- idキー
				- 著者ID
			- formatキー
				- 著者名を"%s"に置き換えた文字列です
				- 補足情報がないときはキー自体がありません
	- publisherキー
	- pubdateキー
		- "yyyymm"形式に置き換えます
	- isbnキー
	- keywordキー
	- tagsキー
		- 値は以下のキーがあるマップのリストです
			- idキー
				- タグID
			- valueキー
				- タグ値（未指定時はキー自体無し）
	- bodyキー
		- HTML化します
	- noteキー
		- HTML化します
	- secretキー
		- HTML化します

### 公開マスタファイル

　全体がひとつのマップです。

* pubyearsキー
	- 刊行年（"yyyy"形式）のリスト
* pubdateキー
	- 刊行年キー（"yyyy"形式）
		- 刊行年月キー（"yyyymm"形式）
			- reviewIDのリスト
* authorsキー
	- 値はマップです
	  マップのキーはid、値は以下のキーがあるマップです
		- idキー
			- 半角数字４桁の通番
		- nameキー
			- 著者名
		- hiraNameキー
		- reviewsキー
			- reviewIDのリスト
* tagsキー
	- 値はマップです
	  マップのキーはid、値は以下のキーがあるマップです
		- id
			- 半角数字４桁の通番
		- nameキー
			- タグ名
		- reviewsキー
			- reviewIDのリスト
* categoriesキー
	- 値は以下のマップのリストです。
		- id
			- 半角数字４桁の通番
		- nameキー
			- カテゴリ名
		- tagsキー
			- タグIDのリスト

